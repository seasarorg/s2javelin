<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML>
<HEAD>
<TITLE>S2Javelin</TITLE>
<META http-equiv=Content-Type content="text/html; charset=Shift_JIS">
<META http-equiv=Content-Style-Type content=text/css>
<LINK media=screen href="http://www.seasar.org/seasar_b.css"
	type=text/css rel=stylesheet>
<LINK media=print href="http://www.seasar.org/seasar_p.css"
	type=text/css rel=stylesheet>


</HEAD>
<BODY>
<TABLE cellSpacing=0 cellPadding=0 width="100%" align=left border=0>
	<TBODY>
		<TR>
			<TD vAlign=top align=left width=780>
			<TABLE class=white cellSpacing=0 cellPadding=0 width=780 border=0>
				<TBODY>
					<TR>
						<TD colSpan=7><IMG height=5 alt=""
							src="http://www.seasar.org/images/top01_b.gif" width=780></TD>
					</TR>
					<TR>
						<TD><IMG height=117 alt=Seasar
							src="http://www.seasar.org/images/top02_b.gif" width=235></TD>
						<TD colSpan=3><IMG height=117 alt="DI Container with AOP"
							src="http://www.seasar.org/images/top03.gif" width=289></TD>
						<TD colSpan=3><IMG height=117 alt="" src="spacer.gif" width=256></TD>
					</TR>
					<TR>
						<TD rowSpan=2><IMG height=49 alt=""
							src="http://www.seasar.org/images/top04.gif" width=235></TD>
						<TD><A href="http://www.seasar.org/index.html"><IMG height=30
							alt="" src="http://www.seasar.org/images/menu01_b_ja.gif"
							width=78 border=0></A></TD>
						<TD><A href="http://www.seasar.org/projects.html"><IMG height=30
							alt="" src="http://www.seasar.org/images/menu02_b_ja.gif"
							width=101 border=0></A></TD>
						<TD><A href="http://www.seasar.org/products.html"><IMG height=30
							alt="" src="http://www.seasar.org/images/menu03_b_ja.gif"
							width=110 border=0></A></TD>
						<TD><A href="http://www.seasar.org/resources.html"><IMG height=30
							alt="" src="http://www.seasar.org/images/menu04_b_ja.gif"
							width=113 border=0></A></TD>
						<TD><IMG height=30 alt=""
							src="http://www.seasar.org/images/menu05_b_ja.gif" width=109
							border=0></TD>
						<TD><IMG height=30 alt=""
							src="http://www.seasar.org/images/menu06.gif" width=34></TD>
					</TR>
					<TR>
						<TD colSpan=6><IMG height=19 alt="" src="spacer.gif" width=545></TD>
					</TR>
				</TBODY>
			</TABLE>
			<TABLE class=white cellSpacing=0 cellPadding=0 width=780 border=0>
				<TBODY>
					<TR vAlign=top align=left>
						<TD width=14><IMG height=14 alt="" src="spacer.gif" width=14></TD>
						<TD class=main width=740><!-- don't edit end --><!-- document start -->

						<IMG height=10 alt="" src="spacer.gif" width=14>

						<H1><A name=title style="font-size:32;">S2Javelin</A></H1>

						<center><img src="arrowvision_1.gif" alt="スクリーンショット" width="576"
							height="590" vspace="5"></center>

						<center>
						<P>※表示しているのは、S2JSF-exampleのEmployee Managementの動作<br>ログをS2Javelinで取得し、ArrowVisionで表示したものです。</P>
						</center>

						<UL>
							<LI><A href="index.html#abstraction">概要</A>
							<LI><A href="index.html#download">ダウンロード</A>
							<LI><A href="index.html#setup">インストール方法</A>
							<OL>
								<LI><A href="index.html#setup_lib">1.ライブラリの配置</A>
								<LI><A href="index.html#setup_dicon">2.diconの設定</A>
								<LI><A href="index.html#setup_log4j">3.log4jプロパティの修正</A>
							</OL>
							<LI><A href="index.html#usage">使用方法</A>
							<LI><A href="index.html#arrowvision">ArrowVisionについて</A>
						</UL>

			            <H1><A name=new></A>更新履歴</H1>
							<u><h5>2006/01/19 : Ver0.2.0リリース</h5></u>
								Ver0.2.0を公開しました。<br>
								<b>例外のthrow〜catchをログ出力</b>できるようになりました。<br>
								ArrowVisionで表示することで、例外のthrow〜catchの矢印が図示されます。<br>
								
						<u><h5>2005/12/08 : ページ公開＆Ver0.1.0リリース</h5></u>
							Ver0.1.0を公開しました。<br>
							メソッドの呼び出し、戻りをログ出力できます。<br>
							ArrowVisionで表示することで、例外のthrow〜catchの矢印を図示することができます。<br>

						<H1><A name=abstraction>概要</A></H1>
						<P>S2Javelinは、SeasarのAOP機構を利用し、Seasar上のアプリケーションの動作ログを出力するツールです。
						また、Seasarアプリケーション上で発行されたSQLについても、同様にログを取得します。</P>
						<P>出力した動作ログとSQLログは、そのままArrowVision(※１)を用いてシーケンス図表示させることが可能です。</P>

						<center><img src="component.jpg" alt="部品の組み込み" width="445"
							height="355" vspace="20"></center>
						<P>S2Javelinの実態はSeasar2に標準添付されているTraceInterceptorの一種ですので、diconファイルへの追記で、簡単に設定できます。</P>
						<P>※１）ArrowVisionはエスエムジー株式会社が公開しているフリーの解析ツールです。詳しくは<A
							href="index.html#arrowvision">ArrowVisionについて</A>をご参照下さい。</P>


						<H1><A name=download></A>ダウンロード</H1>

						<u>最新版</u>(2006/01/19更新)<br>
						

						<UL>
							<LI>Ver0.2.0 : <A href="S2Javelin-V0.2.0.zip"> S2Javelin-V0.2.0.zip (13KB)</A>
						</UL>

						<u>旧版</u><br>
						<UL>
							<LI>Ver0.1.0 : <A href="S2Javelin-V0.1.0.zip"> S2Javelin-V0.1.0.zip (12KB)</A>
						</UL>

						<H1><A name=setup>インストール方法</A></H1>

						<H2><A name=setup_lib></A>1.ライブラリの配置</H2>
						s2javelin.jarを、解析対象アプリケーションのクラスパスに含めます。
						<H2><A name=setup_dicon></A>2.diconの設定</H2>

						<p>diconにInterceptorの定義を追加します。</p>
						<p>S2Javelinの本体は、ログを独自の形式で出力するInterceptorである"JavelinTraceInterceptor"です。
						このJavelinTraceInterceptorをログ出力対象クラスに適用するために、diconへの追記が必要になります。</p>
						<p>まず、添付のjavelin.diconをコピーして、アプリケーションに含ませてください。</p>
						<p>下はjavelin.diconの内容です。javelinTraceInterceptorの宣言を行っています。</p>
						<pre> &lt;components namespace=&quot;javelin&quot;&gt;
     &lt;component name=&quot;javelinTraceInterceptor&quot;
         class=&quot;org.seasar.javelin.JavelinTraceInterceptor&quot;&gt;
             &lt;property name=&quot;logArgs&quot;&gt;true&lt;/property&gt;
             &lt;property name=&quot;logReturn&quot;&gt;true&lt;/property&gt;
             &lt;property name=&quot;logStackTrace&quot;&gt;false&lt;/property&gt;
     &lt;/component&gt;
 &lt;/components&gt;</pre>
						<p>JavelinTraceInterceptorの３つのプロパティの意味は次の通りです。
						(全てboolean型のプロパティです）</p>
						<p>
						<TABLE border=1>
							<COLGROUP>
								<COL span=3 align=left>
							<TBODY>
								<TR>
									<TH>名前</TH>
									<TH>デフォルト</TH>
									<TH>意味</TH>
								</TR>

								<TR>
									<TD>logArgs</TD>
									<TD>true</TD>
									<TD>trueなら、メソッドの引数値をログに出力します 。</TD>
								</TR>
								<TR>
									<TD>logReturn</TD>
									<TD>true</TD>
									<TD>trueなら、メソッドの戻り値をログに出力します。</TD>
								</TR>
								<TR>
									<TD>logStackTrace</TD>
									<TD>false</TD>
									<TD>trueなら、メソッドが呼び出されるまでのスタックトレースをログ出力します。</TD>
								</TR>
							</TBODY>
						</TABLE>


						<p>※logStackTraceをtrueにすると、ログの量が極端に多くなりますので、注意が必要です。</p>
						<p>
						あとは、aspectとしてjavelinTraceInterceptorをログ対象のクラスに適用します。下はArrayListクラスのメソッド呼び出しをログに出力するための設定例です。
						</p>

						<pre> &lt;components&gt;
     &lt;!-- [1] javelin.diconを含ませる --&gt;
     &lt;include path=&quot;javelin.dicon&quot;/&gt;
 
     （略)
 
     &lt;!-- [2] S2JavelinをArrayListクラスに適用 --&gt;
     &lt;component class=&quot;java.util.ArrayList&gt;
         &lt;aspect&gt;javelin.javelinTraceInterceptor&lt;/aspect&gt;
     &lt;/component&gt;</pre>

						<p>InterceptorChainが既にログ出力対象クラスへ設定されている場合は、S2Javelinの適用も簡単になります。</p>
						<p>
						"sampleInterceptorChain"というInterceptorChainが定義されていた場合の設定例を示します。</p>

						<pre> &lt;components&gt;
     &lt;!-- [1] javelin.diconを含ませる --&gt;
     &lt;include path=&quot;javelin.dicon&quot;/&gt;
 
     &lt;!-- sampleInterceptorChainの定義 --&gt;
     &lt;component name=&quot;sampleInterceptorChain&quot;
             class=&quot;org.seasar.framework.aop.interceptors.InterceptorChain&quot;&gt;
 
         &lt;!-- [2] S2JavelinをChainに追加する --&gt;
         &lt;initMethod name=&quot;add&quot;&gt;
             &lt;arg&gt;javelin.javelinTraceInterceptor&lt;/arg&gt;
         &lt;/initMethod&gt;
 
         （略）
   
     &lt;/component&gt;</pre>


						<p>
						この追記によって、sampleInterceptorChainが設定されている全クラスについて、ログが出力されるようになります。</p>
						<p>また、Seasar
						Ver2.3で追加されたアスペクトの自動登録機能を用いると、パッケージ単位などでの、ログ出力対象クラスの一括指定が可能になります。
						</p>
						<p>下は、examples.di.impl以下の全パッケージについて、名前がImplで終わるクラスを指定した例です。</p>

						<pre> &lt;components&gt;
     &lt;!-- [1] javelin.diconを含ませる --&gt;
     &lt;include path=&quot;javelin.dicon&quot;/&gt;
 
     &lt;!-- [2] S2JavelinをAspectAutoRegisterに追加する --&gt;
     &lt;component class=&quot;org.seasar.framework.container.autoregister.AspectAutoRegister&quot;&gt;
         &lt;property name=&quot;interceptor&quot;&gt;
             javelin.javelinTraceInterceptor
         &lt;/property&gt;
         &lt;!-- [3] ログ出力の対象を指定する --&gt;
         &lt;initMethod name=&quot;addClassPattern&quot;&gt;
             &lt;!-- 1つ目はパッケージの指定 --&gt;
             &lt;arg&gt;&quot;examples.di.impl&quot;&lt;/arg&gt;
             &lt;!-- 2つ目はクラス名の正規表現 --&gt;
             &lt;arg&gt;&quot;.*Impl&quot;&lt;/arg&gt;
         &lt;/initMethod&gt;
 
         &lt;!-- 次の指定は、Seasar Ver2.3.0では&quot;registAll&quot;と書くこと。
              また、Ver2.3.2以降では書く必要はない。 --&gt;
         &lt;initMethod name=&quot;registerAll&quot;/&gt;
 
     &lt;/component&gt;</pre>

						<p>その他にも、登録したくないクラスパターンを指定するなどの、詳細な記述が可能です。詳しくは、こちらを参照してください。</p>

						<ul>
							<li><a
								href="http://s2container.seasar.org/ja/DIContainer.html#AspectAutoRegister">S2Containerリファレンス：「アスペクトの自動登録」</a>
							</li>
						</ul>

						<H2><A name=setup_log4j></A>3.log4jプロパティの修正</H2>

						<p>log4j.propertiesに、次を追記します。
						(添付のlog4j.propertiesファイルが、下と同じ内容のファイルになっています）</p>
						<pre> #S2Javelin Logger
 log4j.category.org.seasar.javelin.JavelinTraceInterceptor=DEBUG, Javelin
 log4j.appender.Javelin=org.apache.log4j.FileAppender
 #S2Javelin log file
 log4j.appender.Javelin.File=c:\\temp\\s2javelin.jvn ←★ログの出力先★
 log4j.appender.Javelin.layout=org.apache.log4j.PatternLayout
 log4j.appender.Javelin.layout.ConversionPattern=%m%n
 log4j.additivity.org.seasar=false
 
 # SQL Logger
 log4j.category.org.seasar.extension.jdbc.impl=DEBUG, DaoSql
 log4j.category.org.seasar.dao=DEBUG, DaoSql
 log4j.appender.DaoSql=org.apache.log4j.FileAppender
 #SQL log file
 log4j.appender.DaoSql.File=c:\\temp\\s2javelin.jvn ←★ログの出力先★
 log4j.appender.DaoSql.layout=org.apache.log4j.PatternLayout
 log4j.appender.DaoSql.layout.ConversionPattern=Write ,%d{yyyy/MM/dd 
 HH:mm:ss.SSS},,DaoSQL,0,%M,%C,0,public,%t%n&lt;&lt;jave lin.FieldValue_START&gt;&gt;
 %n%m%n&lt;&lt;javelin.FieldValue_END&gt;&gt;%n%n</pre>
						<p>★ログの出力先★で示した部分に、ログ出力するファイルのフルパスを指定して ください。</p>



						<H1><A name=usage></A>使用方法</H1>

						<ol>
							<li>インストールが完了したら、対象のSeasarアプリケーションを起動します。<br />
							⇒「インストール」の「log4jプロパティの修正」で指定した場所に、ログファイルが生成されます。</li>
							<li>1で生成されたログファイルを、そのままArrowVisionの画面上にドラッグ＆ドロップしてください。<br />
							⇒SQLの呼び出しも含めた、動作シーケンスが表示されます。</li>
						</ol>
						<H1><A name=arrowvision></A>ArrowVisionについて</H1>

						<p>S2Javelinのログファイルをビジュアルに表示するためにはArrowVisionという表示用ツールが必要になります。</p>
						<p>ArrowVisionは、エスエムジー株式会社のホームページから、無償でダウンロードすることができます。</p>
						<ul>
							<li><a
								href="http://www.smg.co.jp/service/products/arrow_vision/index.html">ArrowVisionダウンロード</a></li>
						</ul>

						<H1><A name=support></A>お問い合わせ</H1>

						<p>質問、改善案、その他何かございましたら、こちらに投稿をお願いします。<br />
						</p>
						<ul>
							<li><a
								href="http://seasar.satin.jp/wiki/index.php?Sandbox%2FS2Javelin">S2Javelin
							Wiki</a></li>
						</ul>

						</TD>
						<TD width=14><IMG height=14 alt="" src="spacer.gif" width=14></TD>
					</TR>
					<TR>
						<TD width=14><IMG height=30 alt="" src="spacer.gif" width=14></TD>
						<TD width=766><IMG height=30 alt="" src="spacer.gif" width=592></TD>
					</TR>
					<TR>
						<TD width=14><IMG height=14 alt="" src="spacer.gif" width=14></TD>
						<TD class=copyright width=766>&copy; Copyright The Seasar
						Foundation and the others 2004, all rights reserved.</TD>
					</TR>
				</TBODY>
			</TABLE>
		</TR>
		<TR>
			<TD class=backunder vAlign=top align=left width=780 height=16>&nbsp;</TD>
			<TD class=backcorner vAlign=top align=left height=16>&nbsp;</TD>
		</TR>
	</TBODY>
</TABLE>
<!-- don't edit end -->
</BODY>
</HTML>
